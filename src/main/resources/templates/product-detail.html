<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${product.name} + ' | Java Shop'">–¢–æ–≤–∞—Ä | Java Shop</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">Java Shop</a>
            <nav class="nav">
                <a href="/" class="nav-link">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                <a href="/admin" class="nav-link admin">‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <a href="/" class="btn btn-secondary" style="margin-bottom: 2rem; display: inline-flex;">
            ‚Üê –ù–∞–∑–∞–¥ –≤ –∫–∞—Ç–∞–ª–æ–≥
        </a>

        <div class="product-detail animate-fade-in">
            <div class="product-detail-image" 
                 th:classappend="${isDigital} ? 'digital' : 'physical'">
                <span th:text="${isDigital} ? 'üíø' : 'üì¶'">üì¶</span>
            </div>
            
            <div class="product-detail-info">
                <span class="product-category" th:if="${product.category != null}" 
                      th:text="${product.category.name}">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</span>
                
                <h1 th:text="${product.name}">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</h1>
                
                <p class="product-price">
                    <span th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')}">10000</span> ‚Ç∏
                </p>
                
                <p style="color: var(--text-secondary); margin-bottom: 2rem;" 
                   th:text="${product.description ?: '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}">
                    –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞...
                </p>

                <ul class="product-specs">
                    <li>
                        <strong>ID —Ç–æ–≤–∞—Ä–∞:</strong>
                        <span th:text="${product.id}">P-001</span>
                    </li>
                    <li>
                        <strong>–ù–∞–ª–∏—á–∏–µ:</strong>
                        <span th:text="${product.quantity + ' —à—Ç.'}">10 —à—Ç.</span>
                    </li>
                    <li>
                        <strong>–°—Ç–∞—Ç—É—Å:</strong>
                        <span class="tag" 
                              th:classappend="${product.stockStatus == 'IN_STOCK'} ? 'tag-physical' : 'tag-digital'"
                              th:text="${product.stockStatus == 'OUT_OF_STOCK'} ? '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏' : 
                                       (${product.stockStatus == 'LOW'} ? '–ú–∞–ª–æ –Ω–∞ —Å–∫–ª–∞–¥–µ' : '–í –Ω–∞–ª–∏—á–∏–∏')">
                            –í –Ω–∞–ª–∏—á–∏–∏
                        </span>
                    </li>
                    <li>
                        <strong>–¢–∏–ø —Ç–æ–≤–∞—Ä–∞:</strong>
                        <span class="tag" 
                              th:classappend="${isDigital} ? 'tag-digital' : 'tag-physical'"
                              th:text="${isDigital} ? '–¶–∏—Ñ—Ä–æ–≤–æ–π' : '–§–∏–∑–∏—á–µ—Å–∫–∏–π'">–¢–∏–ø</span>
                    </li>
                    <li th:if="${isDigital}">
                        <strong>–†–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏:</strong>
                        <span th:text="${#numbers.formatDecimal(downloadSize, 0, 'COMMA', 2, 'POINT') + ' –ú–ë'}">1024 –ú–ë</span>
                    </li>
                    <li th:if="${isPhysical}">
                        <strong>–î–æ—Å—Ç–∞–≤–∫–∞:</strong>
                        <span th:text="${#numbers.formatDecimal(shippingCost, 0, 'COMMA', 0, 'POINT') + ' ‚Ç∏'}">500 ‚Ç∏</span>
                    </li>
                </ul>

                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button class="btn btn-primary" style="flex: 1;">
                        üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                    </button>
                    <button class="btn btn-success">
                        ‚ö° –ö—É–ø–∏—Ç—å —Å–µ–π—á–∞—Å
                    </button>
                </div>
            </div>
        </div>

        <!-- Price Calculator Section -->
        <div class="form-card" style="margin-top: 3rem;">
            <h3>üí∞ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ü–µ–Ω—ã</h3>
            <p style="color: var(--text-muted); margin-bottom: 1.5rem;">
                –†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å —É—á–µ—Ç–æ–º —Å–∫–∏–¥–æ–∫ –∏ –Ω–∞–ª–æ–≥–æ–≤
            </p>
            
            <div class="form-row">
                <div class="form-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                    <input type="number" id="calc-qty" class="form-control" value="1" min="1">
                </div>
                <div class="form-group">
                    <label>–¶–µ–Ω–æ–≤–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞</label>
                    <select id="calc-price-policy" class="form-control">
                        <option value="">–ë–µ–∑ —Å–∫–∏–¥–∫–∏</option>
                        <option th:each="entry : ${pricePolicies}" 
                                th:value="${entry.key}" 
                                th:text="${entry.value.name()}">–ü–æ–ª–∏—Ç–∏–∫–∞</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–ù–∞–ª–æ–≥</label>
                    <select id="calc-tax-policy" class="form-control">
                        <option value="">–ë–µ–∑ –Ω–∞–ª–æ–≥–∞</option>
                        <option th:each="entry : ${taxPolicies}" 
                                th:value="${entry.key}"
                                th:text="${entry.key + ' (' + #numbers.formatDecimal(entry.value.taxRate() * 100, 0, 'COMMA', 1, 'POINT') + '%)'}"
                        >–ù–∞–ª–æ–≥</option>
                    </select>
                </div>
            </div>
            
            <div style="background: linear-gradient(135deg, #f8f9ff 0%, #f0f1f7 100%); padding: 1.5rem; border-radius: 12px; margin-top: 1rem;">
                <p style="font-size: 0.875rem; color: var(--text-muted); margin-bottom: 0.5rem;">–ò—Ç–æ–≥–æ:</p>
                <p id="calc-result" class="product-price" style="font-size: 2rem;">
                    <span th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')}">10000</span> ‚Ç∏
                </p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>¬© 2024 Java Shop. –°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Spring Boot</p>
    </footer>

    <script th:inline="javascript">
        const basePrice = /*[[${product.price}]]*/ 0;
        const productId = /*[[${productId}]]*/ 0;
        
        function formatPrice(price) {
            return new Intl.NumberFormat('ru-RU').format(Math.round(price)) + ' ‚Ç∏';
        }
        
        function calculatePrice() {
            const qty = parseInt(document.getElementById('calc-qty').value) || 1;
            const pricePolicy = document.getElementById('calc-price-policy').value;
            const taxPolicy = document.getElementById('calc-tax-policy').value;
            
            let url = '/api/calculate?productId=' + productId + '&quantity=' + qty;
            if (pricePolicy) url += '&pricePolicy=' + pricePolicy;
            if (taxPolicy) url += '&taxPolicy=' + taxPolicy;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('calc-result').textContent = formatPrice(data.total);
                })
                .catch(() => {
                    // Fallback to basic calculation
                    document.getElementById('calc-result').textContent = formatPrice(basePrice * qty);
                });
        }
        
        document.getElementById('calc-qty').addEventListener('change', calculatePrice);
        document.getElementById('calc-price-policy').addEventListener('change', calculatePrice);
        document.getElementById('calc-tax-policy').addEventListener('change', calculatePrice);
    </script>
</body>
</html>
